# Архитектура системы отслеживания финансов

## Обзор

Микросервисная архитектура для управления личными финансами с поддержкой счетов, транзакций, инвестиций, аналитики и прогнозирования.

## Компоненты системы

### 1. Master Service

Агрегатор и API Gateway для фронтенда. Принимает HTTP запросы, вызывает другие сервисы по gRPC, агрегирует ответы.

**Основная логика:**

- Сохранение транзакций в БД
- Управление бюджетами (по MCC кодам)
- Агрегация данных из Wallet/Market
- Работа с PostgreSQL

**Порт:** 8080 (HTTP)

### 2. Wallet Service

Прокси для Т-Банк API. Только чтение данных из внешнего API.

**Функции:**

- Получение списка счетов из Т-Банк API
- Получение истории транзакций за период
- Получение инвестиционных позиций
- Кеширование ответов (Redis/in-memory)

**Порт:** 50051 (gRPC)

### 3. Market Service

Прокси для рыночных данных. Только чтение из внешних API.

**Функции:**

- Получение информации о ценных бумагах
- Получение текущих цен
- Получение информации о дивидендах
- Кеширование ответов (Redis/in-memory)

**Порт:** 50052 (gRPC)

### 4. Analyzer Service

Аналитика транзакций, прогнозирование баланса.

**Функции:**

- Чтение транзакций из PostgreSQL
- Расчет статистики по категориям
- Построение прогнозов
- Может иметь свою БД

**Порт:** 50053 (gRPC)

### 5. Notification Service

Отправка уведомлений. Работает in-memory или через очередь.

**Порт:** 50054 (gRPC)

## Схема взаимодействия

```
Frontend (HTTP) → Master Service (gRPC) → Wallet / Market / Analyzer / Notification
```

## Use Cases

### 1. Ручной ввод транзакции

Frontend → Master.CreateTransaction → Master сохраняет в БД

### 2. Просмотр баланса

Frontend → Master.GetBalance → Wallet.GetAccounts (из Т-Банк API) → Master агрегирует и отдает

### 3. Аналитика по категориям

Frontend → Master.GetAnalytics → Analyzer.GetStatistics (читает из БД) → Master отдает

### 4. Прогноз баланса

Frontend → Master.GetForecast → Analyzer.GetForecast (анализ данных из БД)

### 5. Уведомления

Scheduler → Notification.SendNotification

## Технологический стек

- Go 1.21+
- gRPC + Protobuf
- PostgreSQL 15+
- Redis (кеш в Master)

## База данных

Единая PostgreSQL база данных для хранения основных данных.

**Таблицы:**

- accounts - счета
- transactions - транзакции (с MCC кодами)
- budgets - бюджеты по MCC кодам
- investment_positions - инвестиционные позиции
- securities - справочник ценных бумаг
- dividends - информация о дивидендах

**Кеширование:**

- **Wallet Service** - собственный кеш (Redis/in-memory) для данных из Т-Банк API
- **Market Service** - собственный кеш (Redis/in-memory) для рыночных данных
- **Master Service** - Redis для агрегированных данных
- **Analyzer** - может иметь дополнительную БД

## Внешние API

- **Т-Банк API** - счета, транзакции, инвестиции
- **Т-Инвестиции API** - информация о ценных бумагах, дивиденды

## Денежные суммы

Хранятся в BIGINT как копейки:

- 100.00 руб = 10000 копеек

```protobuf
message Money {
  int64 amount = 1;      // копейки
  string currency = 2;   // "RUB"
}
```
